<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd">

    <changeSet id="PICK-73:createWorkflowTestData" author="RobinGuth" context="testdata">
        <preConditions onFail="HALT">
            <sequenceExists sequenceName="workflow_id_seq" />
            <sequenceExists sequenceName="node_id_seq" />
            <sequenceExists sequenceName="edge_id_seq" />
            <sequenceExists sequenceName="instance_id_seq" />
            <sequenceExists sequenceName="instance_value_id_seq" />
            <tableExists tableName="workflows"/>
            <tableExists tableName="workflow_nodes"/>
            <tableExists tableName="workflow_edges"/>
            <tableExists tableName="workflow_condition_keys"/>
            <tableExists tableName="workflow_instances"/>
            <tableExists tableName="workflow_instance_values"/>
        </preConditions>

        <sql dbms="postgresql" splitStatements="true">
            INSERT INTO workflows VALUES(nextval('workflow_id_seq'), 'Testflows', 1, now());

            INSERT INTO workflow_nodes VALUES(nextval('node_id_seq'), currval('workflow_id_seq'), 'Planning', 'user_action', 'Planning');
            INSERT INTO workflow_nodes VALUES(nextval('node_id_seq'), currval('workflow_id_seq'), 'Implementation', 'user_action', 'Implementation');
            INSERT INTO workflow_nodes VALUES(nextval('node_id_seq'), currval('workflow_id_seq'), 'Report', 'user_action', 'Report');

            INSERT INTO workflow_edges VALUES(nextval('edge_id_seq'), currval('workflow_id_seq'), currval('node_id_seq') - 2, currval('node_id_seq') - 1);
            INSERT INTO workflow_edges VALUES(nextval('edge_id_seq'), currval('workflow_id_seq'), currval('node_id_seq') - 1, currval('node_id_seq'));

            INSERT INTO workflow_instances VALUES(nextval('instance_id_seq'), currval('workflow_id_seq'), currval('node_id_seq') - 2, true);
            INSERT INTO workflow_instances VALUES(nextval('instance_id_seq'), currval('workflow_id_seq'), currval('node_id_seq') - 2, true);
            INSERT INTO workflow_instances VALUES(nextval('instance_id_seq'), currval('workflow_id_seq'), currval('node_id_seq') - 1, true);

            INSERT INTO workflow_instance_values VALUES(nextval('instance_value_id_seq'), currval('instance_id_seq') - 2, 'userID', 'Leonard', 'STRING', 'WORKFLOW');
            INSERT INTO workflow_instance_values VALUES(nextval('instance_value_id_seq'), currval('instance_id_seq') - 2, 'amount', '7', 'LONG', 'WORKFLOW');
        </sql>
    </changeSet>

</databaseChangeLog>